{% extends 'base.html' %}

{% block title %}{% if is_english %}Pricing Plans{% elif is_spanish %}Planes de Precios{% elif is_german %}Preispläne{% elif is_portuguese %}Planos de Preços{% elif is_chinese %}价格方案{% else %}料金プラン{% endif %} - UTAMEMO{% endblock %}

{% block content %}
<div class="upgrade-container">
    <div class="upgrade-wrapper">
        <!-- Header -->
        <div class="upgrade-header fade-in">
            <h1 class="upgrade-title">{% if is_english %}Pricing Plans{% elif is_spanish %}Planes de Precios{% elif is_german %}Preispläne{% elif is_portuguese %}Planos de Preços{% elif is_chinese %}价格方案{% else %}料金プラン{% endif %}</h1>
            <p class="upgrade-subtitle">{% if is_english %}Choose the plan that fits you and start learning{% elif is_spanish %}Elige el plan que te convenga y comienza a aprender{% elif is_german %}Wählen Sie den Plan, der zu Ihnen passt, und beginnen Sie zu lernen{% elif is_portuguese %}Escolha o plano que combina com você e comece a aprender{% elif is_chinese %}选择适合您的方案，开始学习{% else %}あなたに合ったプランを選んで、学習を始めよう{% endif %}</p>
        </div>

        <!-- Plans Grid -->
        <div class="plans-grid fade-in">
            <!-- Free Plan -->
            <div class="plan-card {% if current_plan == 'free' %}current{% endif %}">
                <div class="plan-header">
                    <h3 class="plan-name">{% if is_english %}Free{% elif is_spanish %}Gratis{% elif is_german %}Kostenlos{% elif is_portuguese %}Grátis{% elif is_chinese %}免费{% else %}フリー{% endif %}</h3>
                    <div class="plan-price">
                        <span class="price-amount">¥0</span>
                        <span class="price-period">/{% if is_english %}mo{% elif is_spanish %}mes{% elif is_german %}Monat{% elif is_portuguese %}mês{% elif is_chinese %}月{% else %}月{% endif %}</span>
                    </div>
                </div>
                <div class="plan-description">{% if is_english %}For those who want to try first{% elif is_spanish %}Para quienes quieren probar primero{% elif is_german %}Für alle, die es erst ausprobieren möchten{% elif is_portuguese %}Para quem quer experimentar primeiro{% elif is_chinese %}适合想先试用的用户{% else %}まずは試してみたい方に{% endif %}</div>
                <ul class="plan-features">
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Up to 2 songs/day{% elif is_spanish %}Hasta 2 canciones/día{% elif is_german %}Bis zu 2 Lieder/Tag{% elif is_portuguese %}Até 2 músicas/dia{% elif is_chinese %}每天最多2首{% else %}1日2曲まで生成{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Unlimited v7.5 model{% elif is_spanish %}Modelo v7.5 ilimitado{% elif is_german %}Unbegrenztes v7.5 Modell{% elif is_portuguese %}Modelo v7.5 ilimitado{% elif is_chinese %}v7.5模型无限制{% else %}v7.5モデル無制限{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}O2 model 5x/month{% elif is_spanish %}Modelo O2 5 veces/mes{% elif is_german %}O2 Modell 5x/Monat{% elif is_portuguese %}Modelo O2 5x/mês{% elif is_chinese %}O2模型每月5次{% else %}O2モデル月5回{% endif %}</li>
                    <li class="unavailable"><i class="bi bi-x"></i>{% if is_english %}Karaoke mode{% elif is_spanish %}Modo karaoke{% elif is_german %}Karaoke-Modus{% elif is_portuguese %}Modo karaokê{% elif is_chinese %}卡拉OK模式{% else %}カラオケモード{% endif %}</li>
                    <li class="unavailable"><i class="bi bi-x"></i>{% if is_english %}Reference song{% elif is_spanish %}Canción de referencia{% elif is_german %}Referenzlied{% elif is_portuguese %}Música de referência{% elif is_chinese %}参考曲{% else %}リファレンス曲{% endif %}</li>
                </ul>
                {% if current_plan == 'free' %}
                <button class="plan-btn current" disabled>{% if is_english %}Current Plan{% elif is_spanish %}Plan Actual{% elif is_german %}Aktueller Plan{% elif is_portuguese %}Plano Atual{% elif is_chinese %}当前方案{% else %}現在のプラン{% endif %}</button>
                {% else %}
                <button class="plan-btn secondary" disabled>{% if is_english %}Free Plan{% elif is_spanish %}Plan Gratis{% elif is_german %}Kostenloser Plan{% elif is_portuguese %}Plano Grátis{% elif is_chinese %}免费方案{% else %}無料プラン{% endif %}</button>
                {% endif %}
            </div>

            <!-- Starter Plan -->
            <div class="plan-card recommended {% if current_plan == 'starter' %}current{% endif %}">
                <div class="recommend-badge">{% if is_english %}Recommended{% elif is_spanish %}Recomendado{% elif is_german %}Empfohlen{% elif is_portuguese %}Recomendado{% elif is_chinese %}推荐{% else %}おすすめ{% endif %}</div>
                <div class="plan-header">
                    <h3 class="plan-name">{% if is_english %}Starter{% elif is_spanish %}Inicial{% elif is_german %}Starter{% elif is_portuguese %}Iniciante{% elif is_chinese %}入门{% else %}スターター{% endif %}</h3>
                    <div class="plan-price">
                        <span class="price-amount">¥780</span>
                        <span class="price-period">/{% if is_english %}mo{% elif is_spanish %}mes{% elif is_german %}Monat{% elif is_portuguese %}mês{% elif is_chinese %}月{% else %}月{% endif %}</span>
                    </div>
                </div>
                <div class="plan-description">{% if is_english %}For individual serious users{% elif is_spanish %}Para usuarios individuales serios{% elif is_german %}Für ernsthafte Einzelnutzer{% elif is_portuguese %}Para usuários individuais sérios{% elif is_chinese %}适合认真使用的个人用户{% else %}個人でしっかり使いたい方に{% endif %}</div>
                <ul class="plan-features">
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Up to 70 songs/month{% elif is_spanish %}Hasta 70 canciones/mes{% elif is_german %}Bis zu 70 Lieder/Monat{% elif is_portuguese %}Até 70 músicas/mês{% elif is_chinese %}每月最多70首{% else %}月70曲まで生成{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}All models available{% elif is_spanish %}Todos los modelos disponibles{% elif is_german %}Alle Modelle verfügbar{% elif is_portuguese %}Todos os modelos disponíveis{% elif is_chinese %}所有模型可用{% else %}全モデル利用可能{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Karaoke mode{% elif is_spanish %}Modo karaoke{% elif is_german %}Karaoke-Modus{% elif is_portuguese %}Modo karaokê{% elif is_chinese %}卡拉OK模式{% else %}カラオケモード{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Reference song{% elif is_spanish %}Canción de referencia{% elif is_german %}Referenzlied{% elif is_portuguese %}Música de referência{% elif is_chinese %}参考曲{% else %}リファレンス曲{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}No ads{% elif is_spanish %}Sin anuncios{% elif is_german %}Keine Werbung{% elif is_portuguese %}Sem anúncios{% elif is_chinese %}无广告{% else %}広告非表示{% endif %}</li>
                </ul>
                {% if current_plan == 'starter' %}
                <button class="plan-btn current" disabled>{% if is_english %}Current Plan{% elif is_spanish %}Plan Actual{% elif is_german %}Aktueller Plan{% elif is_portuguese %}Plano Atual{% elif is_chinese %}当前方案{% else %}現在のプラン{% endif %}</button>
                {% else %}
                <button class="plan-btn primary checkout-btn" data-plan="starter">{% if is_english %}Start Starter{% elif is_spanish %}Comenzar Inicial{% elif is_german %}Starter Beginnen{% elif is_portuguese %}Começar Iniciante{% elif is_chinese %}开始入门{% else %}スターターを始める{% endif %}</button>
                {% endif %}
            </div>

            <!-- Pro Plan -->
            <div class="plan-card {% if current_plan == 'pro' %}current{% endif %}">
                <div class="plan-header">
                    <h3 class="plan-name">{% if is_english %}Pro{% elif is_spanish %}Pro{% elif is_german %}Pro{% elif is_portuguese %}Pro{% elif is_chinese %}专业{% else %}プロ{% endif %}</h3>
                    <div class="plan-price">
                        <span class="price-amount">¥1,900</span>
                        <span class="price-period">/{% if is_english %}mo{% elif is_spanish %}mes{% elif is_german %}Monat{% elif is_portuguese %}mês{% elif is_chinese %}月{% else %}月{% endif %}</span>
                    </div>
                </div>
                <div class="plan-description">{% if is_english %}For heavy users{% elif is_spanish %}Para usuarios intensivos{% elif is_german %}Für Power-User{% elif is_portuguese %}Para usuários intensivos{% elif is_chinese %}适合重度用户{% else %}ヘビーユーザー向け{% endif %}</div>
                <ul class="plan-features">
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Unlimited songs{% elif is_spanish %}Canciones ilimitadas{% elif is_german %}Unbegrenzte Lieder{% elif is_portuguese %}Músicas ilimitadas{% elif is_chinese %}无限歌曲{% else %}曲数無制限{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Unlimited all models{% elif is_spanish %}Todos los modelos ilimitados{% elif is_german %}Alle Modelle unbegrenzt{% elif is_portuguese %}Todos os modelos ilimitados{% elif is_chinese %}所有模型无限制{% else %}全モデル無制限{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Karaoke mode{% elif is_spanish %}Modo karaoke{% elif is_german %}Karaoke-Modus{% elif is_portuguese %}Modo karaokê{% elif is_chinese %}卡拉OK模式{% else %}カラオケモード{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Reference song{% elif is_spanish %}Canción de referencia{% elif is_german %}Referenzlied{% elif is_portuguese %}Música de referência{% elif is_chinese %}参考曲{% else %}リファレンス曲{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Priority queue{% elif is_spanish %}Cola prioritaria{% elif is_german %}Prioritätswarteschlange{% elif is_portuguese %}Fila prioritária{% elif is_chinese %}优先队列{% else %}優先キュー{% endif %}</li>
                </ul>
                {% if current_plan == 'pro' %}
                <button class="plan-btn current" disabled>{% if is_english %}Current Plan{% elif is_spanish %}Plan Actual{% elif is_german %}Aktueller Plan{% elif is_portuguese %}Plano Atual{% elif is_chinese %}当前方案{% else %}現在のプラン{% endif %}</button>
                {% else %}
                <button class="plan-btn primary checkout-btn" data-plan="pro">{% if is_english %}Start Pro{% elif is_spanish %}Comenzar Pro{% elif is_german %}Pro Beginnen{% elif is_portuguese %}Começar Pro{% elif is_chinese %}开始专业{% else %}プロを始める{% endif %}</button>
                {% endif %}
            </div>

            <!-- School Plan -->
            <div class="plan-card {% if current_plan == 'school' %}current{% endif %}">
                <div class="plan-header">
                    <h3 class="plan-name">{% if is_english %}School{% elif is_spanish %}Escuela{% elif is_german %}Schule{% elif is_portuguese %}Escola{% elif is_chinese %}学校{% else %}スクール{% endif %}</h3>
                    <div class="plan-price">
                        <span class="price-amount">¥450</span>
                        <span class="price-period">/{% if is_english %}student/mo{% elif is_spanish %}estudiante/mes{% elif is_german %}Schüler/Monat{% elif is_portuguese %}aluno/mês{% elif is_chinese %}学生/月{% else %}生徒/月{% endif %}</span>
                    </div>
                </div>
                <div class="plan-description">{% if is_english %}For educational institutions{% elif is_spanish %}Para instituciones educativas{% elif is_german %}Für Bildungseinrichtungen{% elif is_portuguese %}Para instituições educacionais{% elif is_chinese %}适合教育机构{% else %}教育機関向け{% endif %}</div>
                <ul class="plan-features">
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}100 songs/student/month{% elif is_spanish %}100 canciones/estudiante/mes{% elif is_german %}100 Lieder/Schüler/Monat{% elif is_portuguese %}100 músicas/aluno/mês{% elif is_chinese %}每学生每月100首{% else %}生徒1人あたり月100曲{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}All models available{% elif is_spanish %}Todos los modelos disponibles{% elif is_german %}Alle Modelle verfügbar{% elif is_portuguese %}Todos os modelos disponíveis{% elif is_chinese %}所有模型可用{% else %}全モデル利用可能{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Class sharing{% elif is_spanish %}Compartir en clase{% elif is_german %}Klassenfreigabe{% elif is_portuguese %}Compartilhamento de turma{% elif is_chinese %}班级共享{% else %}クラス共有機能{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Teacher dashboard{% elif is_spanish %}Panel del profesor{% elif is_german %}Lehrer-Dashboard{% elif is_portuguese %}Painel do professor{% elif is_chinese %}教师仪表板{% else %}教師用ダッシュボード{% endif %}</li>
                    <li class="available"><i class="bi bi-check"></i>{% if is_english %}Bulk management{% elif is_spanish %}Gestión masiva{% elif is_german %}Massenverwaltung{% elif is_portuguese %}Gerenciamento em massa{% elif is_chinese %}批量管理{% else %}一括管理{% endif %}</li>
                </ul>
                {% if current_plan == 'school' %}
                <button class="plan-btn current" disabled>{% if is_english %}Current Plan{% elif is_spanish %}Plan Actual{% elif is_german %}Aktueller Plan{% elif is_portuguese %}Plano Atual{% elif is_chinese %}当前方案{% else %}現在のプラン{% endif %}</button>
                {% else %}
                <a href="{% url 'users:school_inquiry' %}" class="plan-btn secondary" style="text-decoration: none; text-align: center; display: block;">{% if is_english %}Contact Us{% elif is_spanish %}Contáctenos{% elif is_german %}Kontaktieren Sie uns{% elif is_portuguese %}Fale Conosco{% elif is_chinese %}联系我们{% else %}お問い合わせ{% endif %}</a>
                {% endif %}
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="faq-section fade-in">
            <h2 class="faq-title">{% if is_english %}Frequently Asked Questions{% elif is_spanish %}Preguntas Frecuentes{% elif is_german %}Häufig Gestellte Fragen{% elif is_portuguese %}Perguntas Frequentes{% elif is_chinese %}常见问题{% else %}よくある質問{% endif %}</h2>
            <div class="faq-list">
                <div class="faq-item">
                    <div class="faq-question">{% if is_english %}Can I cancel anytime?{% elif is_spanish %}¿Puedo cancelar en cualquier momento?{% elif is_german %}Kann ich jederzeit kündigen?{% elif is_portuguese %}Posso cancelar a qualquer momento?{% elif is_chinese %}可以随时取消吗？{% else %}いつでも解約できますか？{% endif %}</div>
                    <div class="faq-answer">{% if is_english %}Yes, you can cancel anytime. You can continue using until the end of your billing period.{% elif is_spanish %}Sí, puede cancelar en cualquier momento. Puede seguir usando hasta el final de su período de facturación.{% elif is_german %}Ja, Sie können jederzeit kündigen. Sie können bis zum Ende Ihres Abrechnungszeitraums weiter nutzen.{% elif is_portuguese %}Sim, você pode cancelar a qualquer momento. Você pode continuar usando até o final do seu período de cobrança.{% elif is_chinese %}是的，您可以随时取消。您可以继续使用直到计费周期结束。{% else %}はい、いつでも解約可能です。解約後も期間終了まで利用できます。{% endif %}</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">{% if is_english %}What payment methods are available?{% elif is_spanish %}¿Qué métodos de pago están disponibles?{% elif is_german %}Welche Zahlungsmethoden sind verfügbar?{% elif is_portuguese %}Quais métodos de pagamento estão disponíveis?{% elif is_chinese %}有哪些付款方式？{% else %}支払い方法は？{% endif %}</div>
                    <div class="faq-answer">{% if is_english %}We accept credit cards (Visa, Mastercard, JCB, Amex).{% elif is_spanish %}Aceptamos tarjetas de crédito (Visa, Mastercard, JCB, Amex).{% elif is_german %}Wir akzeptieren Kreditkarten (Visa, Mastercard, JCB, Amex).{% elif is_portuguese %}Aceitamos cartões de crédito (Visa, Mastercard, JCB, Amex).{% elif is_chinese %}我们接受信用卡（Visa、Mastercard、JCB、Amex）。{% else %}クレジットカード（Visa, Mastercard, JCB, Amex）に対応しています。{% endif %}</div>
                </div>
                <div class="faq-item">
                    <div class="faq-question">{% if is_english %}Can I change my plan?{% elif is_spanish %}¿Puedo cambiar mi plan?{% elif is_german %}Kann ich meinen Plan ändern?{% elif is_portuguese %}Posso mudar meu plano?{% elif is_chinese %}可以更改方案吗？{% else %}プラン変更はできますか？{% endif %}</div>
                    <div class="faq-answer">{% if is_english %}Yes, you can change anytime. Upgrades take effect immediately.{% elif is_spanish %}Sí, puede cambiar en cualquier momento. Las actualizaciones se aplican inmediatamente.{% elif is_german %}Ja, Sie können jederzeit wechseln. Upgrades werden sofort wirksam.{% elif is_portuguese %}Sim, você pode mudar a qualquer momento. Atualizações entram em vigor imediatamente.{% elif is_chinese %}是的，您可以随时更改。升级立即生效。{% else %}はい、いつでも変更可能です。アップグレードは即時反映されます。{% endif %}</div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.upgrade-container {
    min-height: 100vh;
    background: linear-gradient(135deg, #fafafa 0%, #f5f5f5 100%);
    padding: 40px 20px;
}

.upgrade-wrapper {
    max-width: 1200px;
    margin: 0 auto;
}

.upgrade-header {
    text-align: center;
    margin-bottom: 40px;
}

.upgrade-title {
    font-size: 1.8rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 8px;
}

.upgrade-subtitle {
    color: #666;
    font-size: 1rem;
}

/* Plans Grid */
.plans-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    gap: 20px;
    margin-bottom: 50px;
}

.plan-card {
    background: white;
    border-radius: 16px;
    padding: 28px 24px;
    box-shadow: 0 2px 12px rgba(0,0,0,0.06);
    position: relative;
    transition: transform 0.2s, box-shadow 0.2s;
    border: 2px solid transparent;
}

.plan-card:hover {
    transform: translateY(-4px);
    box-shadow: 0 8px 24px rgba(0,0,0,0.1);
}

.plan-card.recommended {
    border-color: #ff6b35;
}

.recommend-badge {
    position: absolute;
    top: -10px;
    right: 16px;
    background: #ff6b35;
    color: white;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.plan-header {
    margin-bottom: 12px;
}

.plan-name {
    font-size: 1.2rem;
    font-weight: 700;
    color: #333;
    margin-bottom: 8px;
}

.plan-price {
    display: flex;
    align-items: baseline;
    gap: 4px;
}

.price-amount {
    font-size: 2rem;
    font-weight: 800;
    color: #ff6b35;
}

.price-period {
    font-size: 0.9rem;
    color: #888;
}

.plan-description {
    color: #666;
    font-size: 0.9rem;
    margin-bottom: 20px;
    padding-bottom: 16px;
    border-bottom: 1px solid #eee;
}

.plan-features {
    list-style: none;
    padding: 0;
    margin: 0 0 24px 0;
}

.plan-features li {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 8px 0;
    font-size: 0.9rem;
}

.plan-features li.available {
    color: #333;
}

.plan-features li.available i {
    color: #4CAF50;
}

.plan-features li.unavailable {
    color: #bbb;
}

.plan-features li.unavailable i {
    color: #ddd;
}

.plan-btn {
    width: 100%;
    padding: 12px 16px;
    border: none;
    border-radius: 10px;
    font-size: 0.95rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.plan-btn.primary {
    background: linear-gradient(135deg, #ff6b35, #ff8c5a);
    color: white;
}

.plan-btn.primary:hover {
    background: linear-gradient(135deg, #e55a28, #ff6b35);
}

.plan-btn.secondary {
    background: #f5f5f5;
    color: #666;
}

.plan-btn.secondary:hover {
    background: #eee;
}

.plan-btn.current {
    background: #e8e8e8;
    color: #999;
    cursor: default;
}

/* FAQ Section */
.faq-section {
    max-width: 700px;
    margin: 0 auto;
}

.faq-title {
    font-size: 1.3rem;
    font-weight: 700;
    color: #333;
    text-align: center;
    margin-bottom: 24px;
}

.faq-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.faq-item {
    background: white;
    border-radius: 12px;
    padding: 18px 20px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.04);
}

.faq-question {
    font-weight: 600;
    color: #333;
    margin-bottom: 8px;
    font-size: 0.95rem;
}

.faq-answer {
    color: #666;
    font-size: 0.9rem;
    line-height: 1.6;
}

/* Animation */
.fade-in {
    animation: fadeIn 0.5s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Responsive */
@media (max-width: 768px) {
    .plans-grid {
        grid-template-columns: 1fr;
        max-width: 360px;
        margin-left: auto;
        margin-right: auto;
    }
    
    .upgrade-title {
        font-size: 1.5rem;
    }
    
    .price-amount {
        font-size: 1.8rem;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const isLoggedIn = {{ user.is_authenticated|yesno:"true,false" }};
    const checkoutBtns = document.querySelectorAll('.checkout-btn');
    
    checkoutBtns.forEach(btn => {
        btn.addEventListener('click', async function() {
            const plan = this.dataset.plan;
            
            if (!isLoggedIn) {
                if (confirm('プランを購入するにはログインが必要です。ログインページに移動しますか？')) {
                    window.location.href = '{% url "users:login" %}?next={% url "users:upgrade" %}';
                }
                return;
            }
            
            const originalText = this.textContent;
            this.textContent = '処理中...';
            this.disabled = true;
            
            try {
                const response = await fetch('{% url "users:create_checkout" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': '{{ csrf_token }}',
                    },
                    body: JSON.stringify({ plan: plan })
                });
                
                const data = await response.json();
                
                if (data.checkout_url) {
                    window.location.href = data.checkout_url;
                } else if (data.error) {
                    alert('エラー: ' + data.error);
                }
            } catch (error) {
                console.error('Error:', error);
                alert('エラーが発生しました');
            }
            
            this.textContent = originalText;
            this.disabled = false;
        });
    });
});
</script>
{% endblock %}
