# UTAMEMO - 学習支援AIアプリケーション

## アプリ名
UTAMEMO（ウタメモ）  
ノートや教科書の内容を「歌」で覚える学習支援 Web アプリケーション

**https://utamemo.com**

## 概要
教科書やノートの画像をアップロードすると、AI が内容を読み取り、覚えやすい歌詞を自動生成します。  
さらに、AI がその歌詞から楽曲を生成することで、音楽を聞きながら楽しく暗記・復習ができるアプリです。

## 主な機能

### 楽曲生成
- 画像からのテキスト抽出（OCR）
- 学習内容を歌詞に変換（暗記に最適化した歌詞生成）
- 漢字・数字の自動ひらがな変換
- AI による楽曲生成（ジャンル・ボーカルスタイル選択可能）
- ボカロ風ボーカル対応（女性 / 男性）
- 手動での歌詞入力モード
- 音楽スタイルプロンプトによるカスタマイズ

### カラオケモード
- 手動スクロール型の歌詞表示（楽曲再生中に歌詞を見ながら練習）

### ユーザー管理
- ユーザー登録・ログイン機能
- プロフィール画像設定（Base64 で DB 保存、サーバー再起動後も維持）
- 自己紹介（bio）
- ユーザー名のコンテンツフィルタリング（不適切な名前・メールアドレス形式をブロック）

### 楽曲管理
- マイページでの楽曲一覧・管理
- 楽曲の公開 / 非公開設定
- 楽曲詳細ページでの削除機能（PC / スマートフォン両対応）
- タグ機能
- コメント機能

### クラスルーム
- クラスルーム作成・参加（招待コード）
- クラスルームへの楽曲共有
- クラスメンバー管理

### ソーシャル機能
- 総再生回数の表示（全ユーザーの再生数をカウント）
- いいね・お気に入り機能（ソングリストからも操作可能）
- クリエイターアバター表示（ソングリストでプロフィールへリンク）

### セキュリティ・プライバシー
- ユーザーデータの暗号化（Fernet 対称鍵暗号）
- 非公開楽曲はサーバー管理者も閲覧不可
- アップロード画像の自動削除（楽曲生成完了後にサーバー容量を節約）
- 不適切コンテンツフィルター（歌詞・ユーザー名）

### 多言語・レスポンシブ
- 多言語対応（日本語 / English / Español / Deutsch / Português / 中文）
- レスポンシブデザイン（PC / スマートフォン対応）
- SEO 対応（サイトマップ生成）

### 法務・コンプライアンス
- 利用規約 / プライバシーポリシー / 特定商取引法に基づく表記
- 各国法規対応（EU GDPR、ドイツ Impressum 等）

---

## 技術スタック

### バックエンド
- Python 3.11（本番） / 3.14（開発）
- Django 5.2.7
- PostgreSQL（本番） / SQLite（開発）
- Gunicorn + WhiteNoise

### AI サービス
- **Google Gemini API**（gemini-2.5-flash）
  - OCR（画像からテキスト抽出）
  - 歌詞生成
  - ひらがな変換
- **Mureka AI API**（楽曲生成 / V8・O2・V7.6・V7.5 モデル対応）

### 主要パッケージ
- google-generativeai（Gemini AI）
- cryptography（暗号化）
- Pillow（画像処理）
- requests（HTTP 通信）
- fugashi + unidic-lite（日本語形態素解析）
- PyMuPDF（PDF 処理）
- channels / daphne（WebSocket）

### デプロイ
- Render（Python 3.11.0 / PostgreSQL）
- HTTPS 通信
- カスタムドメイン（utamemo.com）

---

## プロジェクト構成
```
UTAMEMO/
├── myproject/
│   ├── myproject/          # Django設定
│   │   ├── settings.py     # 各種設定
│   │   ├── urls.py         # URLルーティング
│   │   ├── sitemaps.py     # SEOサイトマップ
│   │   ├── security.py     # セキュリティ設定
│   │   ├── context_processors.py  # テンプレート共通変数
│   │   └── wsgi.py / asgi.py
│   ├── songs/              # 楽曲管理アプリ
│   │   ├── models.py       # データモデル (Song, Lyrics, Tag, Classroom等)
│   │   ├── views.py        # ビュー
│   │   ├── ai_services.py  # AI統合 (Gemini, Mureka)
│   │   ├── content_filter.py  # コンテンツフィルタリング
│   │   ├── encryption.py   # 暗号化機能
│   │   └── urls.py
│   ├── users/              # ユーザー管理アプリ
│   │   ├── models.py
│   │   ├── views.py
│   │   ├── forms.py        # バリデーション（メール形式チェック等）
│   │   └── urls.py
│   ├── templates/          # HTMLテンプレート
│   ├── static/             # 静的ファイル
│   ├── media/              # アップロード画像（一時）
│   └── manage.py
├── requirements.txt        # 依存パッケージ
├── Procfile                # Render デプロイ設定
├── build.sh                # ビルドスクリプト
└── README.md
```

---

## セキュリティ機能
- ユーザーデータの暗号化（Fernet 対称鍵暗号 / AES-128-CBC + HMAC-SHA256）
- 非公開楽曲のタイトル・歌詞・原文を暗号化保存
- 公開時のみ復号化して平文保存
- プロフィール画像は Base64 エンコードで DB に直接保存
- アップロード画像は楽曲生成完了後に自動削除（個人情報保護）
- 環境変数での秘密情報管理（`.env`）
- HTTPS 通信（本番環境）

---

## 動作確認環境

### 必須要件
- Python 3.11.x
- Django 5.x
- macOS / Windows 10 / 11

### 推奨ブラウザ
- Google Chrome（最新版）
- Microsoft Edge（最新版）
- Firefox（最新版）

---

## デプロイメント関連ドキュメント

- **[ドメイン設定と DNS レコードの確認（日本語）](DOMAIN_SETUP.md)**
- **[Domain Setup and DNS Records (English)](DOMAIN_SETUP_EN.md)**

---

## 使い方

1. アカウント登録（https://utamemo.com）
2. 教材の写真をアップロード（または手動で歌詞入力）
3. AI が歌詞を生成 → ジャンル・ボーカルスタイルを選択
4. 楽曲が自動生成されます
5. マイページで楽曲を聴いたり管理できます
6. カラオケモードで歌詞を見ながら練習

---

## プライバシー・倫理・安全性への配慮

### ① 個人情報やプライバシーへの配慮

- **最小限のデータ収集**: ユーザー名、メールアドレス、パスワードのみを必須情報として収集
- **非公開楽曲の暗号化**: Fernet 対称鍵暗号を使用し、非公開設定の楽曲データを暗号化保存
- **サーバー管理者も閲覧不可**: 暗号化されたデータは復号鍵なしでは読み取り不可能
- **アップロード画像の自動削除**: 教科書・ノート画像は楽曲生成完了後に自動的にサーバーから削除
- **プロフィール画像の DB 保存**: 外部ファイル参照ではなく Base64 で DB に直接保存し、ファイルアクセスリスクを排除
- **ユーザー主導の削除**: ユーザーは自分の楽曲・アカウントをいつでも削除可能
- **公開 / 非公開の選択権**: 楽曲ごとに設定でき、プライバシーをユーザー自身がコントロール

### ② 著作権・ライセンスの扱い

- **オリジナルコンテンツの生成**: AI が生成する歌詞・楽曲は、既存の楽曲をコピーするのではなく、ユーザーの学習内容に基づいてオリジナルで生成
- **学習目的の利用**: 教科書・ノートの内容を「暗記用の歌」に変換する教育目的での利用を想定
- **API 利用規約の遵守**: Google Gemini API、Mureka AI API の利用規約に従って使用
- **ユーザーへの責任明示**: アップロードするコンテンツの著作権についてはユーザー自身の責任であることを前提

### ③ データの扱い

- **暗号化技術**: Fernet 対称鍵暗号（AES-128-CBC + HMAC-SHA256）
- **安全な通信**: HTTPS 通信による暗号化（Render 本番環境）
- **環境変数での秘密情報管理**: API キー、SECRET_KEY は `.env` ファイルで管理
- **データベースセキュリティ**: PostgreSQL（本番環境）でのセキュアなデータ保存
- **一時ファイルの適切な処理**: アップロード画像は処理完了後に自動削除
- **セッション管理**: Django 標準のセッション管理機能を使用

### ④ AI・センサー等を使う場合の倫理配慮

- **透明性**: AI による歌詞生成・楽曲生成であることをユーザーに明示。使用 AI サービス（Gemini、Mureka）を明記
- **ユーザーの編集権**: AI 生成後もユーザーが歌詞を自由に編集可能
- **目的の明確化**: 教育・学習支援という明確な目的での AI 利用
- **過度なデータ収集の回避**: AI 処理に必要な最小限のデータのみを送信
- **バイアスへの配慮**: 学習コンテンツをそのまま歌詞化するため、AI 独自の偏見が入りにくい設計
- **人間の判断の尊重**: 最終的な公開・利用判断はユーザーが行う

### ⑤ 利用者や社会にとって安心できる工夫

- **教育目的の明確化**: 「勉強を楽しくする」という前向きな目的を明示
- **多言語対応**: 6 言語に対応し、多様なユーザーが利用可能
- **直感的な UI**: 複雑な操作なしで利用でき、デジタルリテラシーに関わらず使用可能
- **レスポンシブデザイン**: PC・スマートフォン両方で快適に利用可能
- **エラーハンドリング**: 処理中のエラーを適切に通知
- **再試行機能**: 楽曲生成に失敗した場合の自動再試行（最大 3 回）
- **コンテンツフィルタリング**: 不適切な歌詞・ユーザー名を自動検出・ブロック
- **コミュニティ機能の適切な制限**: 公開楽曲のみ他ユーザーが閲覧可能

---

## 開発者
Yu

## バージョン
2.0.0（2026 年 2 月 25 日）

## 更新履歴
- **v2.0.0** (2026/2/25)
  - ユーザー名にメールアドレス形式が使われた場合のバリデーション追加
  - カラオケモードを手動スクロール型にリファクタリング（LLM タイミング推定を廃止）
  - 楽曲詳細ページに削除ボタン追加（PC 対応）
  - アップロードページのローディング UX 改善
  - ボカロ風ボーカルスタイル追加（女性 / 男性）
  - 管理画面の強化（全モデル登録、フィルタ・検索）
  - ユーザー名コンテンツフィルター追加
  - 各国法規対応（ES / DE / PT / ZH）
  - 法務ページ拡充（特定商取引法、利用規約 AI 著作権条項）
- **v1.2.0** (2026/1/14)
  - プロフィール画像の Base64 保存（Render 再起動後も維持）
  - 総再生回数表示
  - アップロード画像の自動削除
  - クリエイターアバター表示（ソングリスト）
  - ソングリストからのいいね・お気に入り機能
  - モバイル UI/UX の改善
- **v1.1.0** (2026/1/14)
  - 多言語対応（日本語 / English / 中文）
  - プロフィール画像機能
  - 楽曲削除機能
  - リファレンス楽曲機能
  - UI/UX 全体的な改善
